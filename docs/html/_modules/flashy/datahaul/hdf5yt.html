
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>flashy.datahaul.hdf5yt &#8212; flashy 0.0.4 documentation</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">flashy 0.0.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for flashy.datahaul.hdf5yt</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">yt</span>
<span class="kn">from</span> <span class="nn">flashy.utils</span> <span class="k">import</span> <span class="n">np</span><span class="p">,</span> <span class="n">getBearing</span><span class="p">,</span> <span class="n">byMass</span><span class="p">,</span> <span class="n">rot</span>
<span class="kn">from</span> <span class="nn">flashy.nuclear</span> <span class="k">import</span> <span class="n">sortNuclides</span><span class="p">,</span> <span class="n">msol</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="k">import</span> <span class="n">trapz</span>
<span class="c1"># avoid yt warnings</span>
<span class="kn">from</span> <span class="nn">yt.funcs</span> <span class="k">import</span> <span class="n">mylog</span>
<span class="n">mylog</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># custom fields</span>
<span class="k">def</span> <span class="nf">_speed</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">vx</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;flash&#39;</span><span class="p">,</span> <span class="s1">&#39;velx&#39;</span><span class="p">]</span>
    <span class="n">vy</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;flash&#39;</span><span class="p">,</span> <span class="s1">&#39;vely&#39;</span><span class="p">]</span>
    <span class="n">spd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vx</span><span class="o">*</span><span class="n">vx</span> <span class="o">+</span> <span class="n">vy</span><span class="o">*</span><span class="n">vy</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">spd</span>
<span class="c1">#yt.add_field((&quot;flash&quot;,&quot;speed&quot;), function=_speed, units=&quot;cm/s&quot;, take_log=False)</span>


<div class="viewcode-block" id="getLineout"><a class="viewcode-back" href="../../../flashy.datahaul.html#flashy.datahaul.hdf5yt.getLineout">[docs]</a><span class="k">def</span> <span class="nf">getLineout</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="s1">&#39;temperature&#39;</span><span class="p">,</span> <span class="s1">&#39;pressure&#39;</span><span class="p">],</span> <span class="n">species</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">radius</span><span class="o">=</span><span class="mf">5e11</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="s1">&#39;cartesian&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="p">[],</span> <span class="n">srcnames</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a np.array with radius, dens, temp, pres and species specified.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        fname (str): filename to extract data from.</span>
<span class="sd">        species (bool): toggle nuclide data.</span>
<span class="sd">        radius (float): reach of lineout.</span>
<span class="sd">        geom (str): geometry ([&#39;cartesian&#39;], &#39;spherical&#39;).</span>
<span class="sd">        direction (list of float): angles of lineout.</span>
<span class="sd">            takes x/(x,z) as normals for 2D/3D. </span>
<span class="sd">            also sets dimensionality.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        dblock (numpy array): matrix with fields as columns.</span>
<span class="sd">        species (list of str): names of species in the checkpoint.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="c1"># spherical (r, theta, phi)</span>
    <span class="c1"># cartesian (x, y, z)</span>
    <span class="n">cname</span><span class="p">,</span> <span class="n">bearing</span> <span class="o">=</span> <span class="n">getBearing</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="n">geom</span><span class="p">)</span>
    <span class="n">ray</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">ray</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">radius</span><span class="o">*</span><span class="n">bearing</span><span class="p">)</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>
    <span class="n">dblock</span> <span class="o">=</span> <span class="n">ray</span><span class="p">[</span><span class="n">cname</span><span class="p">][</span><span class="n">rs</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
        <span class="n">dblock</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">dblock</span><span class="p">,</span> <span class="n">ray</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">rs</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">sps</span> <span class="o">=</span> <span class="n">getFields</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">field_list</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">species</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sps</span><span class="p">:</span>
            <span class="c1"># force (&#39;flash&#39;, s) to ensure it retireves the checkpoint data instead of a yt variable.</span>
            <span class="n">dblock</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">dblock</span><span class="p">,</span> <span class="n">ray</span><span class="p">[(</span><span class="s1">&#39;flash&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">))][</span><span class="n">rs</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">sps</span> <span class="o">=</span> <span class="n">getFields</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">field_list</span><span class="p">,</span> <span class="n">srcnames</span><span class="o">=</span><span class="n">srcnames</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dblock</span><span class="p">,</span> <span class="n">sps</span></div>


<div class="viewcode-block" id="getFields"><a class="viewcode-back" href="../../../flashy.datahaul.html#flashy.datahaul.hdf5yt.getFields">[docs]</a><span class="k">def</span> <span class="nf">getFields</span><span class="p">(</span><span class="n">flist</span><span class="p">,</span> <span class="n">srcnames</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;filters flash checkpoint field list, extracting species found</span>
<span class="sd">    in the checkpoint (including named exceptions, see source).</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        flist(tuple list): ds.derived_field_list from yt.</span>
<span class="sd">        srcnames(bool): return original names for species (n, d, t).</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        fields (list of str): field names in checkpoint.</span>
<span class="sd">        species (list of str): nuclide codes as in checkpoint.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fields</span><span class="p">,</span> <span class="n">species</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">exceptions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span> <span class="p">]</span>
    <span class="n">parsedvals</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;n1&#39;</span><span class="p">,</span> <span class="s1">&#39;p1&#39;</span><span class="p">,</span> <span class="s1">&#39;d2&#39;</span><span class="p">,</span> <span class="s1">&#39;t3&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span> <span class="ow">in</span> <span class="n">flist</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">char</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">field</span><span class="p">):</span>
            <span class="n">species</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">field</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">exceptions</span><span class="p">:</span>
            <span class="n">species</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
    <span class="n">species</span> <span class="o">=</span> <span class="n">sortNuclides</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
    <span class="c1"># once sorted, rename the exceptions</span>
    <span class="k">if</span> <span class="n">srcnames</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parsedvals</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">species</span><span class="p">:</span>
                <span class="n">species</span><span class="p">[</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">e</span><span class="p">)]</span> <span class="o">=</span> <span class="n">exceptions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">fields</span><span class="p">,</span> <span class="n">species</span></div>


<div class="viewcode-block" id="getMeta"><a class="viewcode-back" href="../../../flashy.datahaul.html#flashy.datahaul.hdf5yt.getMeta">[docs]</a><span class="k">def</span> <span class="nf">getMeta</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">print_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;returns metadata from checkpoint and yt-dereived fields.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        fname(str): filename to check.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        (float): simtime of checkpoint.</span>
<span class="sd">        (dict): flash.par dictionary.</span>
<span class="sd">        (list of str): fields in checkpoint.</span>
<span class="sd">        (list of str): species in checkpoint.</span>
<span class="sd">        (list of str): fullpath, filename of checkpoint.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">print_stats</span><span class="p">:</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
    <span class="n">fields</span><span class="p">,</span> <span class="n">species</span> <span class="o">=</span> <span class="n">getFields</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">derived_field_list</span><span class="p">)</span>
    <span class="n">filepaths</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">fullpath</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">parameter_filename</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">current_time</span><span class="p">),</span> <span class="n">ds</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">filepaths</span></div>


<div class="viewcode-block" id="getExtrema"><a class="viewcode-back" href="../../../flashy.datahaul.html#flashy.datahaul.hdf5yt.getExtrema">[docs]</a><span class="k">def</span> <span class="nf">getExtrema</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">flist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="s1">&#39;temperature&#39;</span><span class="p">,</span> <span class="s1">&#39;pressure&#39;</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;returns a list of tuples with extrema for given fields(flist).</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        fname(str): filename to probe.</span>
<span class="sd">        flist(list of str): fields to query.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        (list of np.arrays): list of paired extrema [min max] for each field queried.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">ad</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">all_data</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">flist</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ad</span><span class="o">.</span><span class="n">quantities</span><span class="o">.</span><span class="n">extrema</span><span class="p">(</span><span class="n">flist</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ad</span><span class="o">.</span><span class="n">quantities</span><span class="o">.</span><span class="n">extrema</span><span class="p">(</span><span class="n">flist</span><span class="p">)]</span></div>


<div class="viewcode-block" id="getYields"><a class="viewcode-back" href="../../../flashy.datahaul.html#flashy.datahaul.hdf5yt.getYields">[docs]</a><span class="k">def</span> <span class="nf">getYields</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;returns time, summed masses and species in a flash otp file.</span>
<span class="sd">    all units are msun or cgs.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        fname(str): filename to inspect.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        time (float) [s], </span>
<span class="sd">        species names: (list of str),</span>
<span class="sd">        masses: (float list) [msun]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">ad</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">all_data</span><span class="p">()</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">species</span> <span class="o">=</span> <span class="n">getFields</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">field_list</span><span class="p">)</span>
    <span class="n">masses</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">quantities</span><span class="o">.</span><span class="n">weighted_average_quantity</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="s1">&#39;cell_mass&#39;</span><span class="p">)</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">quantities</span><span class="o">.</span><span class="n">total_mass</span><span class="p">()</span>
    <span class="n">msunMs</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">value</span><span class="o">*</span><span class="n">total</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="n">msol</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">masses</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">current_time</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">msunMs</span></div>
    

<div class="viewcode-block" id="wedge2d"><a class="viewcode-back" href="../../../flashy.datahaul.html#flashy.datahaul.hdf5yt.wedge2d">[docs]</a><span class="k">def</span> <span class="nf">wedge2d</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">elevation</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[]):</span>
    <span class="sd">&quot;&quot;&quot;cut a wedge in a 2d rectangular domain to perform velocity </span>
<span class="sd">    vs mass fraction measurements.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        fname(str): file name</span>
<span class="sd">        elevation(float): equator-north pole wedge angle.</span>
<span class="sd">        depth(float): equator-south pole wedge angle.</span>
<span class="sd">        fields(str list): override default fields.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple of np.arrays): raw data, [species list].</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">domx</span><span class="p">,</span> <span class="n">domy</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">domain_width</span><span class="o">.</span><span class="n">value</span>
    
    <span class="c1"># top cylinder pivoting on the top right of the domain</span>
    <span class="c1"># this sets the equator-south pole angle</span>
    <span class="n">alt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>

    <span class="n">diag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.25</span><span class="o">*</span><span class="n">domy</span><span class="o">*</span><span class="n">domy</span> <span class="o">+</span> <span class="n">domx</span><span class="o">*</span><span class="n">domx</span><span class="p">)</span>
    <span class="n">diagang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">domy</span><span class="o">/</span><span class="n">domx</span><span class="p">)</span>

    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">alt</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">domx</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span>  <span class="n">domx</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">domy</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">domx</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">domy</span>
    <span class="n">normal</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">domx</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">domy</span> <span class="o">-</span> <span class="n">h</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">depth</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">:</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">delta</span><span class="o">+</span><span class="n">eps</span>
        <span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="n">domx</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">domy</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alt</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="n">domy</span>
        <span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">domy</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>        

    <span class="n">cylinder1</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">disk</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">arr</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span> 
                        <span class="n">normal</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">arr</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span>
                        <span class="n">radius</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">domy</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span>  <span class="c1"># absurd radius to grab all cells.</span>
                        <span class="n">height</span><span class="o">=</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">))</span>

    <span class="c1"># bottom cylinder pivoting on the bottom left of the domain</span>
    <span class="c1"># this sets the equator-north pole angle</span>
    <span class="n">alt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">elevation</span><span class="p">)</span>

    <span class="n">diag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.25</span><span class="o">*</span><span class="n">domy</span><span class="o">*</span><span class="n">domy</span> <span class="o">+</span> <span class="n">domx</span><span class="o">*</span><span class="n">domx</span><span class="p">)</span>
    <span class="n">diagang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">domy</span><span class="o">/</span><span class="n">domx</span><span class="p">)</span>

    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">alt</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">domx</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span>  <span class="n">domx</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">domy</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">domx</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">domy</span>
    <span class="n">normal</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">domx</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">domy</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">elevation</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">:</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">delta</span><span class="o">+</span><span class="n">eps</span>
        <span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="n">domx</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">domy</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alt</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="n">domy</span>
        <span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">domy</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>

    <span class="n">cylinder2</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">disk</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">arr</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span>
                        <span class="n">normal</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">arr</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span>
                        <span class="n">radius</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">domy</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span>  <span class="c1"># absurd radius to grab all cells.</span>
                        <span class="n">height</span><span class="o">=</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">))</span>
    <span class="n">wedge</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">intersection</span><span class="p">([</span><span class="n">cylinder1</span><span class="p">,</span> <span class="n">cylinder2</span><span class="p">])</span>
    
    <span class="c1"># get fields and data from data file</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">species</span> <span class="o">=</span> <span class="n">getFields</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">field_list</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;velx&#39;</span><span class="p">,</span> <span class="s1">&#39;vely&#39;</span><span class="p">,</span> <span class="s1">&#39;velz&#39;</span><span class="p">,</span> <span class="s1">&#39;cell_mass&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">species</span>
        <span class="c1"># rawd 0 1 2 3 fixed.</span>
        <span class="c1"># offset = 4</span>
        <span class="c1"># ask yt for data, as always this takes forever.</span>
        <span class="n">rawd</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">rawd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wedge</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rawd</span><span class="p">,</span> <span class="n">species</span>  <span class="c1"># WARNING: this might be humongous. </span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rawd</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">rawd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wedge</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rawd</span></div>


<div class="viewcode-block" id="wedge3d"><a class="viewcode-back" href="../../../flashy.datahaul.html#flashy.datahaul.hdf5yt.wedge3d">[docs]</a><span class="k">def</span> <span class="nf">wedge3d</span><span class="p">(</span><span class="n">chkp</span><span class="p">,</span> <span class="n">elevation</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[],</span> <span class="n">antipode</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;cut a wedge in a 3d rectangular domain to perform velocity </span>
<span class="sd">    vs mass fraction measurements.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        fname(str): file name</span>
<span class="sd">        elevation(float): equator-north pole wedge angle.</span>
<span class="sd">        depth(float): equator-south pole wedge angle.</span>
<span class="sd">        reference(str): equinox reference for the equator.</span>
<span class="sd">        fields(str list): override default fields.</span>
<span class="sd">        antipode(bool): invert selection, antipodal wedge.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple of np.arrays): raw data sorted by field.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">chkp</span><span class="p">)</span>
    <span class="n">domx</span><span class="p">,</span> <span class="n">domy</span><span class="p">,</span> <span class="n">domz</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">domain_width</span><span class="o">.</span><span class="n">value</span>
    <span class="n">rad</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">domain_width</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># huge radius to grab all cells.</span>
    <span class="n">inv</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="k">if</span> <span class="n">antipode</span> <span class="k">else</span> <span class="mf">1.0</span>  <span class="c1"># flip selection </span>

    <span class="n">tvec</span><span class="p">,</span> <span class="n">bvec</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">domy</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">domz</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">domy</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">domz</span><span class="p">)],</span>
    <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">domx</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">domz</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">domx</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">domz</span><span class="p">)],</span>
    <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">domx</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">domy</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">domx</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">domy</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)]</span>
    <span class="p">}[</span><span class="n">reference</span><span class="p">]</span>
    <span class="n">topv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tvec</span><span class="p">)</span>
    <span class="n">botv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bvec</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">depth</span><span class="o">*</span><span class="n">elevation</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">:</span>
        <span class="c1"># in this case we are on a quadrant</span>
        <span class="k">if</span> <span class="n">depth</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">:</span>
            <span class="c1"># upper right, use 2 bottom cylinders:</span>
            <span class="c1"># normal bot cylinder up to abs(depth)</span>
            <span class="n">equ</span> <span class="o">=</span> <span class="mi">45</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>
            <span class="n">alt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">equ</span><span class="p">)</span>
            <span class="n">rm</span> <span class="o">=</span> <span class="n">rot</span><span class="p">(</span><span class="o">-</span><span class="n">alt</span><span class="p">,</span> <span class="n">reference</span><span class="p">)</span>
            <span class="n">normal</span> <span class="o">=</span> <span class="n">rm</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">botv</span><span class="p">)</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alt</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">botv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">botv</span><span class="p">))</span>
            <span class="n">center</span> <span class="o">=</span> <span class="n">botv</span><span class="o">*</span><span class="n">inv</span>
            <span class="n">cylinder1</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">disk</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">arr</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span> <span class="n">normal</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">arr</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span>
                                <span class="n">radius</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">domy</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">))</span>
            <span class="c1"># second cylinder up to elevation but flipped to grab the wedge</span>
            <span class="n">equ</span> <span class="o">=</span> <span class="mi">45</span> <span class="o">-</span> <span class="n">elevation</span>
            <span class="n">alt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">equ</span><span class="p">)</span>
            <span class="n">rm</span> <span class="o">=</span> <span class="n">rot</span><span class="p">(</span><span class="o">-</span><span class="n">alt</span><span class="p">,</span> <span class="n">reference</span><span class="p">)</span>
            <span class="n">normal</span> <span class="o">=</span> <span class="n">rm</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">botv</span><span class="p">)</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alt</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">botv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">botv</span><span class="p">))</span>
            <span class="n">center</span> <span class="o">=</span> <span class="o">-</span><span class="n">botv</span><span class="o">*</span><span class="n">inv</span>
            <span class="n">cylinder2</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">disk</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">arr</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span> <span class="n">normal</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">arr</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span>
                                <span class="n">radius</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">domy</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># lower right, use 2 top cylinders:</span>
            <span class="c1"># first top goes down to depth and in inverted</span>
            <span class="n">equ</span> <span class="o">=</span> <span class="mi">45</span> <span class="o">-</span> <span class="n">depth</span>  <span class="c1"># 45 degree offset from center-origin reference</span>
            <span class="n">dep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">equ</span><span class="p">)</span>
            <span class="n">rm</span> <span class="o">=</span> <span class="n">rot</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">reference</span><span class="p">)</span>
            <span class="n">normal</span> <span class="o">=</span> <span class="n">rm</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">topv</span><span class="p">)</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">topv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">topv</span><span class="p">))</span>
            <span class="n">center</span> <span class="o">=</span> <span class="n">topv</span><span class="o">*</span><span class="n">inv</span>
            <span class="n">cylinder1</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">disk</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">arr</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span> <span class="n">normal</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">arr</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span>
                                <span class="n">radius</span><span class="o">=</span><span class="p">(</span><span class="n">rad</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">))</span>
            <span class="c1"># second top cylinder goes down to abs(elevation)</span>
            <span class="n">equ</span> <span class="o">=</span> <span class="mi">45</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">elevation</span><span class="p">)</span>  <span class="c1"># 45 degree offset from center-origin reference</span>
            <span class="n">dep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">equ</span><span class="p">)</span>
            <span class="n">rm</span> <span class="o">=</span> <span class="n">rot</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">reference</span><span class="p">)</span>
            <span class="n">normal</span> <span class="o">=</span> <span class="n">rm</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">topv</span><span class="p">)</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">topv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">topv</span><span class="p">))</span>
            <span class="n">center</span> <span class="o">=</span> <span class="o">-</span><span class="n">topv</span><span class="o">*</span><span class="n">inv</span>
            <span class="n">cylinder2</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">disk</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">arr</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span> <span class="n">normal</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">arr</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span>
                                <span class="n">radius</span><span class="o">=</span><span class="p">(</span><span class="n">rad</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># default wedge covering the equator</span>
        <span class="c1"># top cylinder</span>
        <span class="n">equ</span> <span class="o">=</span> <span class="mi">45</span> <span class="o">-</span> <span class="n">depth</span>  <span class="c1"># 45 degree offset from center-origin reference</span>
        <span class="n">dep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">equ</span><span class="p">)</span>
        <span class="n">rm</span> <span class="o">=</span> <span class="n">rot</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">reference</span><span class="p">)</span>
        <span class="n">normal</span> <span class="o">=</span> <span class="n">rm</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">topv</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">topv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">topv</span><span class="p">))</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">topv</span><span class="o">*</span><span class="n">inv</span>
        <span class="n">cylinder1</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">disk</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">arr</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span> <span class="n">normal</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">arr</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span>
                            <span class="n">radius</span><span class="o">=</span><span class="p">(</span><span class="n">rad</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">))</span>
        <span class="c1"># bottom cylinder</span>
        <span class="n">equ</span> <span class="o">=</span> <span class="mi">45</span> <span class="o">-</span> <span class="n">elevation</span>  <span class="c1"># 45 degree offset from center-origin reference</span>
        <span class="n">alt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">equ</span><span class="p">)</span>
        <span class="n">rm</span> <span class="o">=</span> <span class="n">rot</span><span class="p">(</span><span class="o">-</span><span class="n">alt</span><span class="p">,</span> <span class="n">reference</span><span class="p">)</span>

        <span class="n">normal</span> <span class="o">=</span> <span class="n">rm</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">botv</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alt</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">botv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">botv</span><span class="p">))</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">botv</span><span class="o">*</span><span class="n">inv</span>
        <span class="n">cylinder2</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">disk</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">arr</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span> <span class="n">normal</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">arr</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span>
                            <span class="n">radius</span><span class="o">=</span><span class="p">(</span><span class="n">rad</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="s2">&quot;code_length&quot;</span><span class="p">))</span>

    <span class="n">wedge</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">intersection</span><span class="p">([</span><span class="n">cylinder1</span><span class="p">,</span> <span class="n">cylinder2</span><span class="p">])</span>
    <span class="c1">#XXX</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cylinders created, getting data&#39;</span><span class="p">)</span>
    <span class="c1"># get fields and data from data file</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">species</span> <span class="o">=</span> <span class="n">getFields</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">field_list</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;velx&#39;</span><span class="p">,</span> <span class="s1">&#39;vely&#39;</span><span class="p">,</span> <span class="s1">&#39;velz&#39;</span><span class="p">,</span> <span class="s1">&#39;cell_mass&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">species</span>
        <span class="c1"># rawd 0 1 2 3 fixed.</span>
        <span class="c1"># offset = 4</span>
        <span class="c1"># ask yt for data, as always this takes forever.</span>
        <span class="n">rawd</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">rawd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wedge</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rawd</span><span class="p">,</span> <span class="n">species</span>  <span class="c1"># WARNING: this might be humongous. </span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rawd</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">rawd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wedge</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rawd</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">flashy 0.0.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Fernando Rivas.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4.
    </div>
  </body>
</html>