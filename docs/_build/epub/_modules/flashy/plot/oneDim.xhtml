<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <title>flashy.plot.oneDim</title>
    <link rel="stylesheet" href="../../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <h1>Source code for flashy.plot.oneDim</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">_globals</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">linecache</span>

<span class="c1"># custom fields</span>
<span class="k">def</span> <span class="nf">_speed</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">vx</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;flash&#39;</span><span class="p">,</span> <span class="s1">&#39;velx&#39;</span><span class="p">]</span>
    <span class="n">vy</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;flash&#39;</span><span class="p">,</span> <span class="s1">&#39;vely&#39;</span><span class="p">]</span>
    <span class="n">spd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vx</span><span class="o">*</span><span class="n">vx</span> <span class="o">+</span> <span class="n">vy</span><span class="o">*</span><span class="n">vy</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">spd</span>
<span class="c1">#yt.add_field((&quot;flash&quot;,&quot;speed&quot;), function=_speed, units=&quot;cm/s&quot;, take_log=False)</span>

<span class="c1"># yt plotting functions</span>
<div class="viewcode-block" id="fileProfile"><a class="viewcode-back" href="../../../flashy.plot.xhtml#flashy.plot.oneDim.fileProfile">[docs]</a><span class="k">def</span> <span class="nf">fileProfile</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="n">ap13</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">mrange</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mf">5e10</span><span class="p">,</span> <span class="n">filetag</span><span class="o">=</span><span class="s1">&#39;prof&#39;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;plots a checkpoint file ray through the domain.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        fname (str): filename of checkpoint.</span>
<span class="sd">        species (list of str): list of species names to plot.</span>
<span class="sd">        thresh (float): ymin for species fraction plot.</span>
<span class="sd">        radius (float): reach of ray.</span>
<span class="sd">        mrange (list of float): if set, change the mass range of the abundance plot.</span>
<span class="sd">        filetag (str): change prefix of png output files.</span>
<span class="sd">        show (bool): return figure instead of saving it to file.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;chk&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fname</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s2">&quot;Not a checkpoint, skipping abundance plots&quot;</span>
        <span class="n">plotsp</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plotsp</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="c1"># spherical (r, theta, phi)</span>
    <span class="n">cname</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">axis_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ray</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">ray</span><span class="p">([</span><span class="mf">0e5</span><span class="p">,</span> <span class="mf">0e5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="p">,</span> <span class="p">[</span><span class="n">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">ray_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>
    <span class="c1">#fig = plt.figure(figsize=(8, 7), dpi=80)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">plotsp</span><span class="p">:</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">ax4</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box-forced&#39;</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box-forced&#39;</span><span class="p">)</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box-forced&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="n">cname</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">],</span> <span class="n">ray</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density($g/cm^3$)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Radius ($cm$)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">StrMethodFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{x:.2e}</span><span class="s1">&#39;</span><span class="p">))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.5f}</span><span class="s2"> s&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">current_time</span><span class="p">)),</span>
                 <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                 <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="n">cname</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">],</span> <span class="n">ray</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature($K$)&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Radius ($cm$)&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">StrMethodFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{x:.2e}</span><span class="s1">&#39;</span><span class="p">))</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">StrMethodFormatter</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
    
    <span class="n">ax3</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="n">cname</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">],</span> <span class="n">ray</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pressure($dyne/cm^2$)&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Radius ($cm$)&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">StrMethodFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{x:.2e}</span><span class="s1">&#39;</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">plotsp</span><span class="p">:</span>
        <span class="c1"># sort by atomic weight</span>
        <span class="n">aws</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">species</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">==</span><span class="s1">&#39;n   &#39;</span><span class="p">:</span>
                <span class="n">aws</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">s</span><span class="o">==</span><span class="s1">&#39;p   &#39;</span><span class="p">:</span>
                <span class="n">aws</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">s</span><span class="o">==</span><span class="s1">&#39;d   &#39;</span><span class="p">:</span>
                <span class="n">aws</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aws</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()])))</span>
        <span class="n">species</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">aws</span><span class="p">,</span> <span class="n">species</span><span class="p">))</span>
        <span class="n">styleIter</span> <span class="o">=</span> <span class="n">colIter</span><span class="p">()</span>
        <span class="c1"># don&#39;t skip any plot to ensure colors stick to species, and legend doesn&#39;t </span>
        <span class="c1"># shapeshift.</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">byMass</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="n">cname</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">],</span> <span class="n">ray</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="n">sp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">species</span><span class="p">]:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="s1">&#39;$^{{</span><span class="si">{}</span><span class="s1">}}</span><span class="si">{}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">elemSplit</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">styleIter</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ray</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">lgd</span> <span class="o">=</span> <span class="n">ax4</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> 
          <span class="n">columnspacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">markerfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
          <span class="n">numpoints</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mrange</span><span class="p">)</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">mrange</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1e0</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">thresh</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Mass ($M_{\odot}$)&#39;</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$X_</span><span class="si">{frac}</span><span class="s1">$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">rect</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.67</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">parameter_filename</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>
        <span class="n">otpf</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">fullpath</span><span class="p">)</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">filetag</span>
        <span class="n">savn</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
        <span class="n">savf</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">otpf</span><span class="p">,</span> <span class="s2">&quot;png&quot;</span><span class="p">)</span>
        <span class="n">savp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">otpf</span><span class="p">,</span> <span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">savn</span><span class="p">)</span>
        <span class="c1"># build filetree and show or save the figure</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savf</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">savf</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savf</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savf</span><span class="p">,</span> <span class="n">tag</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savf</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savp</span><span class="p">,</span>  <span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">(</span><span class="n">lgd</span><span class="p">,),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s2">&quot;Wrote: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">savp</span><span class="p">)</span></div>

<span class="c1"># utility functions</span>
<div class="viewcode-block" id="getVelocities"><a class="viewcode-back" href="../../../flashy.plot.xhtml#flashy.plot.oneDim.getVelocities">[docs]</a><span class="k">def</span> <span class="nf">getVelocities</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns positions of the shock, and both in an outer cj </span>
<span class="sd">    velocities for a file, plus the starting x_match.</span>
<span class="sd">    (xin, xout, cjin, cjout, float(ray.ds.current_time), ray.ds.parameters[&#39;x_match&#39;])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ray</span><span class="p">,</span> <span class="n">ray_sort</span> <span class="o">=</span> <span class="n">getRay</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">shockin</span><span class="p">,</span> <span class="n">shockout</span> <span class="o">=</span> <span class="n">locateShock</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span> <span class="n">vvv</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">cname</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">axis_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xin</span><span class="p">,</span> <span class="n">xout</span> <span class="o">=</span> <span class="n">ray</span><span class="p">[</span><span class="n">cname</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">][</span><span class="n">shockin</span><span class="p">],</span> <span class="n">ray</span><span class="p">[</span><span class="n">cname</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">][</span><span class="n">shockout</span><span class="p">]</span>
    <span class="n">cjin</span> <span class="o">=</span> <span class="n">roughCJ</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span> <span class="n">shockin</span><span class="p">)</span>
    <span class="n">cjout</span> <span class="o">=</span> <span class="n">roughCJ</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span> <span class="n">shockout</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xin</span><span class="p">,</span> <span class="n">xout</span><span class="p">,</span> <span class="n">cjin</span><span class="p">,</span> <span class="n">cjout</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">ray</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">current_time</span><span class="p">),</span> <span class="n">ray</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;x_match&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="byMass"><a class="viewcode-back" href="../../../flashy.plot.xhtml#flashy.plot.oneDim.byMass">[docs]</a><span class="k">def</span> <span class="nf">byMass</span><span class="p">(</span><span class="n">rads</span><span class="p">,</span> <span class="n">dens</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a mass abscissa for plots.&quot;&quot;&quot;</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rads</span><span class="p">)</span>
    <span class="n">dr</span> <span class="o">=</span> <span class="n">rads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">vol</span> <span class="o">=</span> <span class="n">dr</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.0</span>
    <span class="n">mass</span> <span class="o">=</span> <span class="n">vol</span><span class="o">*</span><span class="n">dens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">Ms</span>
    <span class="n">absc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">absc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mass</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">xs</span><span class="p">):</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="n">rads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">rads</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dvol</span> <span class="o">=</span> <span class="n">dr</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">3.0</span><span class="o">*</span><span class="n">rads</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dr</span><span class="o">*</span><span class="n">dr</span> <span class="p">)</span> <span class="o">*</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.0</span>
        <span class="n">mass</span> <span class="o">=</span> <span class="n">mass</span> <span class="o">+</span> <span class="n">dvol</span><span class="o">*</span><span class="n">dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">Ms</span>
        <span class="n">absc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mass</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">absc</span></div>


<div class="viewcode-block" id="roughCJ"><a class="viewcode-back" href="../../../flashy.plot.xhtml#flashy.plot.oneDim.roughCJ">[docs]</a><span class="k">def</span> <span class="nf">roughCJ</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
    <span class="n">ray_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span> <span class="c1"># not time, this is a grid variable for ordering points</span>
    <span class="n">dp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">][</span><span class="n">point</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ray</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">][</span><span class="n">point</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">nu1</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">][</span><span class="n">point</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">nu2</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">][</span><span class="n">point</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">dnu</span> <span class="o">=</span> <span class="p">(</span><span class="n">nu1</span><span class="o">-</span><span class="n">nu2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">nu1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># print dp, nu1, nu2, dnu</span>
    <span class="k">if</span> <span class="n">dnu</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
        <span class="n">dnu</span><span class="o">=</span><span class="mf">1.0</span>
    <span class="n">svel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dp</span><span class="o">/</span><span class="n">dnu</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">svel</span></div>


<div class="viewcode-block" id="locateShock"><a class="viewcode-back" href="../../../flashy.plot.xhtml#flashy.plot.oneDim.locateShock">[docs]</a><span class="k">def</span> <span class="nf">locateShock</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span> <span class="n">vvv</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;returns index within ray of detected shock.&quot;&quot;&quot;</span>
    <span class="n">ray_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>
    <span class="n">cname</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">axis_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">filt</span><span class="p">,</span> <span class="n">offs1</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="n">cname</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">],</span> <span class="n">ray</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;x_match&#39;</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">shockin</span> <span class="o">=</span> <span class="n">shock1D</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="n">cname</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">][</span><span class="n">filt</span><span class="p">],</span> <span class="n">ray</span><span class="p">[</span><span class="s1">&#39;sound_speed&#39;</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">][</span><span class="n">filt</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">filt</span><span class="p">,</span> <span class="n">offs2</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="n">cname</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">],</span> <span class="n">ray</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;x_match&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">shockout</span> <span class="o">=</span> <span class="n">shock1D</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="n">cname</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">][</span><span class="n">filt</span><span class="p">],</span> <span class="n">ray</span><span class="p">[</span><span class="s1">&#39;sound_speed&#39;</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">][</span><span class="n">filt</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">vvv</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s1">&#39;Ignition Center: &#39;</span><span class="p">,</span> <span class="n">ray</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;x_match&#39;</span><span class="p">]</span>
        <span class="nb">print</span> <span class="s1">&#39;Inward Shock at: </span><span class="si">{:E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="n">cname</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">][</span><span class="n">shockin</span><span class="o">+</span><span class="n">offs1</span><span class="p">]))</span>
        <span class="nb">print</span> <span class="s1">&#39;Outward Shock at: </span><span class="si">{:E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="n">cname</span><span class="p">][</span><span class="n">ray_sort</span><span class="p">][</span><span class="n">shockout</span><span class="o">+</span><span class="n">offs2</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">shockin</span><span class="o">+</span><span class="n">offs1</span><span class="p">,</span> <span class="n">shockout</span><span class="o">+</span><span class="n">offs2</span></div>


<div class="viewcode-block" id="shock1D"><a class="viewcode-back" href="../../../flashy.plot.xhtml#flashy.plot.oneDim.shock1D">[docs]</a><span class="k">def</span> <span class="nf">shock1D</span><span class="p">(</span><span class="n">rad</span><span class="p">,</span> <span class="n">soundspeeds</span><span class="p">,</span> <span class="n">inward</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;finds a shock in an array by detecting the last </span>
<span class="sd">    large variation within it that is larger than the mean of deltas.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">rad</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">soundspeeds</span><span class="p">)</span>
    <span class="n">div</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">ds</span><span class="o">/</span><span class="n">dr</span><span class="p">)</span>
    <span class="n">accel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">ds</span><span class="o">/</span><span class="n">dr</span><span class="p">))</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">accel</span><span class="p">)</span>
    <span class="n">pertp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">accel</span><span class="o">&gt;</span><span class="n">mean</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">inward</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pertp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pertp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="getRay"><a class="viewcode-back" href="../../../flashy.plot.xhtml#flashy.plot.oneDim.getRay">[docs]</a><span class="k">def</span> <span class="nf">getRay</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">5e11</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;returns a ray trace through the domain.&quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">ray</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">ray</span><span class="p">([</span><span class="mf">0e5</span><span class="p">,</span> <span class="mf">0e5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="p">,</span> <span class="p">[</span><span class="n">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">ray_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ray</span><span class="p">,</span> <span class="n">ray_sort</span></div>


<div class="viewcode-block" id="customFormatter"><a class="viewcode-back" href="../../../flashy.plot.xhtml#flashy.plot.oneDim.customFormatter">[docs]</a><span class="k">def</span> <span class="nf">customFormatter</span><span class="p">(</span><span class="n">factor</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;specialized format for plotting labels:</span>
<span class="sd">    width(prec) x 10^factor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fstr</span> <span class="o">=</span> <span class="s1">&#39;{:</span><span class="si">{width}</span><span class="s1">.</span><span class="si">{prec}</span><span class="s1">f}&#39;</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="mf">10.0</span><span class="o">**</span><span class="n">factor</span>
    <span class="k">return</span> <span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span><span class="n">fstr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">exp</span><span class="p">,</span> 
                                                   <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> 
                                                   <span class="n">prec</span><span class="o">=</span><span class="n">prec</span><span class="p">))</span></div>


<div class="viewcode-block" id="getExtrema"><a class="viewcode-back" href="../../../flashy.plot.xhtml#flashy.plot.oneDim.getExtrema">[docs]</a><span class="k">def</span> <span class="nf">getExtrema</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">flist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="s1">&#39;temperature&#39;</span><span class="p">,</span> <span class="s1">&#39;pressure&#39;</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;returns a list of tuples with extrema for given fields(flist).&quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">ad</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">all_data</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ad</span><span class="o">.</span><span class="n">quantities</span><span class="o">.</span><span class="n">extrema</span><span class="p">(</span><span class="n">flist</span><span class="p">)</span></div>


<div class="viewcode-block" id="gridInfo"><a class="viewcode-back" href="../../../flashy.plot.xhtml#flashy.plot.oneDim.gridInfo">[docs]</a><span class="k">def</span> <span class="nf">gridInfo</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;prints checkpoint file grid stats </span>
<span class="sd">    through yt.print_stats() method.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">current_time</span><span class="p">)</span></div>


<div class="viewcode-block" id="writeProf"><a class="viewcode-back" href="../../../flashy.plot.xhtml#flashy.plot.oneDim.writeProf">[docs]</a><span class="k">def</span> <span class="nf">writeProf</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">profD</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;writes a 1D profile dict to a file.&quot;&quot;&quot;</span>
    <span class="n">points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">profD</span><span class="p">[</span><span class="s1">&#39;Radius&#39;</span><span class="p">])</span>
    <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">profD</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">header</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">points</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">profD</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:15.8e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">profD</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">)))</span>
    <span class="nb">print</span> <span class="s1">&#39;Wrote: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="getProps"><a class="viewcode-back" href="../../../flashy.plot.xhtml#flashy.plot.oneDim.getProps">[docs]</a><span class="k">def</span> <span class="nf">getProps</span><span class="p">(</span><span class="n">profD</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;returns central dens, temp, rmin, rmax, volume and mass of a 1D profile.&quot;&quot;&quot;</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">profD</span><span class="p">[</span><span class="s1">&#39;Radius&#39;</span><span class="p">])</span>
    <span class="n">mass</span><span class="p">,</span> <span class="n">vol</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span>
    <span class="n">rads</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">profD</span><span class="p">[</span><span class="s1">&#39;Radius&#39;</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pts</span><span class="p">):</span>
        <span class="n">r2</span><span class="p">,</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">profD</span><span class="p">[</span><span class="s1">&#39;Radius&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">profD</span><span class="p">[</span><span class="s1">&#39;Radius&#39;</span><span class="p">][</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="n">r2</span><span class="o">-</span><span class="n">r1</span>
        <span class="n">dvol</span> <span class="o">=</span> <span class="n">dr</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">3.0</span><span class="o">*</span><span class="n">r1</span><span class="o">*</span><span class="n">r2</span> <span class="o">+</span> <span class="n">dr</span><span class="o">*</span><span class="n">dr</span> <span class="p">)</span> <span class="o">*</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.0</span>
        <span class="n">vol</span> <span class="o">+=</span> <span class="n">dvol</span>
        <span class="n">mass</span> <span class="o">+=</span> <span class="n">dvol</span><span class="o">*</span><span class="n">profD</span><span class="p">[</span><span class="s1">&#39;dens&#39;</span><span class="p">][</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">cd</span><span class="p">,</span> <span class="n">ct</span> <span class="o">=</span> <span class="n">profD</span><span class="p">[</span><span class="s1">&#39;dens&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">profD</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">msuns</span> <span class="o">=</span> <span class="n">mass</span><span class="o">/</span><span class="p">(</span><span class="mf">1.989e33</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">r2</span> <span class="o">-</span> <span class="n">profD</span><span class="p">[</span><span class="s1">&#39;Radius&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">pts</span>
    <span class="nb">print</span> <span class="s2">&quot;Points/resolution: </span><span class="si">{}</span><span class="s2"> / </span><span class="si">{:E}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s2">&quot;Central Dens: </span><span class="si">{:E}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cd</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s2">&quot;Central Temp: </span><span class="si">{:E}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s2">&quot;Radius: </span><span class="si">{:E}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s2">&quot;Volume: </span><span class="si">{:E}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vol</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s2">&quot;Mass (Msun): </span><span class="si">{:E}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msuns</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pts</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">cd</span><span class="p">,</span> <span class="n">ct</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">msuns</span></div>

<span class="c1"># auxiliary functions</span>
<div class="viewcode-block" id="getProfData"><a class="viewcode-back" href="../../../flashy.plot.xhtml#flashy.plot.oneDim.getProfData">[docs]</a><span class="k">def</span> <span class="nf">getProfData</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns arrays for radius, dens, temp and a matrix with abundances, </span>
<span class="sd">    as an ordered dictionary.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">linecache</span><span class="o">.</span><span class="n">getline</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; #</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">varsinFile</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">))))</span>
    <span class="n">outDict</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">varsinFile</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">v</span><span class="p">]</span>
        <span class="n">outDict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span>
    <span class="k">return</span> <span class="n">outDict</span></div>


<div class="viewcode-block" id="plotter"><a class="viewcode-back" href="../../../flashy.plot.xhtml#flashy.plot.oneDim.plotter">[docs]</a><span class="k">def</span> <span class="nf">plotter</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">xkey</span><span class="o">=</span><span class="s1">&#39;Radius&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;plots &#39;key&#39; values from a data dictionary&quot;&quot;&quot;</span>
    <span class="n">dataDict</span> <span class="o">=</span> <span class="n">getProfData</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xkey</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">dataDict</span><span class="p">[</span><span class="n">xkey</span><span class="p">],</span> <span class="n">dataDict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dataDict</span><span class="p">[</span><span class="n">xkey</span><span class="p">],</span> <span class="n">dataDict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="percentDiff"><a class="viewcode-back" href="../../../flashy.plot.xhtml#flashy.plot.oneDim.percentDiff">[docs]</a><span class="k">def</span> <span class="nf">percentDiff</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">file1</span><span class="p">,</span> <span class="n">file2</span><span class="p">,</span> <span class="n">diffkey</span><span class="p">,</span> <span class="n">xkey</span><span class="o">=</span><span class="s1">&#39;Radius&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;plots the percentage difference for diffkey for two filenames.&quot;&quot;&quot;</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">getProfData</span><span class="p">(</span><span class="n">file1</span><span class="p">)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">getProfData</span><span class="p">(</span><span class="n">file2</span><span class="p">)</span>
    <span class="n">jake</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">d1</span><span class="p">[</span><span class="n">xkey</span><span class="p">],</span> <span class="n">d2</span><span class="p">[</span><span class="n">xkey</span><span class="p">],</span> <span class="n">d2</span><span class="p">[</span><span class="n">diffkey</span><span class="p">])</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">jake</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d1</span><span class="p">[</span><span class="n">xkey</span><span class="p">],</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d1</span><span class="p">[</span><span class="n">diffkey</span><span class="p">]</span><span class="o">-</span><span class="n">jake</span><span class="p">)</span><span class="o">/</span><span class="n">norm</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>


<div class="viewcode-block" id="getDset"><a class="viewcode-back" href="../../../flashy.plot.xhtml#flashy.plot.oneDim.getDset">[docs]</a><span class="k">def</span> <span class="nf">getDset</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the yt dataset (not compatible with batch/parallel scripts)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">yt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>
</pre></div>

          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>